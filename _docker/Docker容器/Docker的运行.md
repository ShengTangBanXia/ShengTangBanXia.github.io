---
layout: default
title: Dockerçš„è¿è¡Œ
parent: Dockerå®¹å™¨
nav_order: 1
---

# å®¹å™¨è¿è¡Œå‘½ä»¤
## æŒ‡å®šå®¹å™¨è¿è¡Œæ¨¡å¼
å®¹å™¨ä¸€èˆ¬é€šè¿‡docker run è¿è¡Œï¼Œè¿è¡Œæ¨¡å¼åˆ†ä¸º å‰å°æ¨¡å¼ï¼Œå’Œåå°æ¨¡å¼
### åå°æ¨¡å¼
```shell
# åå°æ¨¡å¼ 
docker run -d <IMAGE_NAME>
docker run -d=true <IMAGE_NAME>

#åå°æ¨¡å¼å¯åŠ¨æœåŠ¡ç±»å®¹å™¨
docker run -d <IMAGE_NAME> -g "daemon off"
docker run -d=true <IMAGE_NAME> -g "daemon off"

```
> 1. ä»¥åå°æ¨¡å¼å¯åŠ¨çš„å®¹å™¨ä¼šåœ¨å¯åŠ¨å®¹å™¨çš„æ ¹è¿›ç¨‹é€€å‡ºæ—¶ä¸€åŒé€€å‡ºï¼Œè‹¥æŒ‡å®šäº†--rmï¼Œåˆ™å½“å®ˆæŠ¤è¿›ç¨‹é€€å‡ºæˆ–å®¹å™¨è¿›ç¨‹é€€å‡ºæ—¶ï¼Œå®¹å™¨å°†è¢«åˆ é™¤
> 2. åå°æ¨¡å¼å¤šä½¿ç”¨äºå¯åŠ¨æœåŠ¡ç±»å®¹å™¨ä¾‹å¦‚ nginx, mysqlç­‰ï¼Œåå°å¯åŠ¨è¿™ç±»å®¹å™¨æ—¶ï¼Œéœ€è¦åŠ å¦‚ä¸‹å‚æ•°ä¿è¯å®¹å™¨å¯åŠ¨æˆåŠŸå¹¶èƒ½ä½¿ç”¨ã€‚ä¹Ÿå¯ä»¥åœ¨Dockerfileä¸­ç»™æ­¤ç±»æœåŠ¡æ·»åŠ CMD ["nginx", "-g", "daemon off"]å‘½ä»¤ã€‚
> 3. è¦ä½¿ä»¥åå°æ¨¡å¼å¯åŠ¨çš„å®¹å™¨è¿›è¡Œè¾“å…¥è¾“å‡ºï¼Œéœ€è¦ä½¿ç”¨ç½‘ç»œè¿æ¥æˆ–å…±äº«å·ã€‚

### å‰å°æ¨¡å¼
```shell
# å¸¸è§„æ¨¡å¼
docker run <IMAGE_NAME>
# -aï¼šè®¾ç½®è¿æ¥åˆ°æµ,å¯è®¾ç½®å¤šä¸ªï¼Œä¸è®¾ç½®å°†é»˜è®¤è¿æ¥åˆ°STDOUTå’ŒSTDERR
docker run -a STDIN -a STDOUT <IMAGE_NAME>
# -tï¼šåˆ†é…ä¼ªTTYï¼Œç›¸å½“äºä¸€ä¸ªç»ˆç«¯
docker run -t <IMAGE_NAME>
# -iï¼šä¿æŒSTDINæ‰“å¼€ï¼Œå³ä½¿æœªè¿æ¥ï¼Œç»å¸¸å’Œ-té…åˆä½¿ç”¨
docker run -i <IMAGE_NAME>
# --sig-proxy=trueï¼šå°†æ‰€æœ‰æ¥å—çš„ä¿¡å·ä»£ç†åˆ°è¿›ç¨‹ï¼Œä»…é™åœ¨æ²¡æœ‰ä¼ªTTYæ—¶ä½¿ç”¨
docker run --sig-proxy=true <IMAGE_NAME>
```
> 1. å¯¹äºäº¤äº’è¿›ç¨‹-iï¼Œ-téœ€è¦ä¸€èµ·ä½¿ç”¨ï¼Œè€Œå¯¹äºéœ€è¦æ¥å—æ ‡å‡†è¾“å…¥çš„è¿›ç¨‹ï¼Œåˆ™ä¸èƒ½ä½¿ç”¨-t
> 2. å¯¹äºå®¹å™¨å†…PIDä¸º1çš„è¿›ç¨‹ï¼Œå°†ä¼šå¿½ç•¥æ‰€æœ‰çš„é»˜è®¤æ“ä½œä¿¡å·ï¼Œé™¤éç¼–ç ä¸ºSIGINTæˆ–SIGTERMï¼Œå¦åˆ™æ­¤è¿›ç¨‹ä¸ä¼šè¢«ç»ˆæ­¢ï¼Œåç»­å¯åˆ©ç”¨è¿™ä¸€ç‚¹è®¾ç½®å®¹å™¨è¿›ç¨‹çš„PIDã€‚

## è®¾ç½®å®¹å™¨èº«ä»½æ ‡è¯†
### è®¾ç½®å®¹å™¨å
```shell
docker run --name <CONTAINER_NAME> <IMAGE_NAME>
docker run --name="<CONTAINER_NAME>" <IMAGE_NAME>
```
> 1. è¯†åˆ«å®¹å™¨å¯ä»¥é€šè¿‡ä¸‰ç§é€”å¾„ï¼š
>    1. é•¿IDï¼šç”±dockerå®ˆæŠ¤è¿›ç¨‹éšæœºåˆ†é…ï¼Œé•¿åº¦64
>    2. çŸ­IDï¼šä¸ºé•¿IDçš„å‰12ä½å­—ç¬¦ç»„æˆ
>    3. å®¹å™¨åï¼šè‹¥æœªç”¨--nameæŒ‡ä»¤æŒ‡å®šåç§°ä¼šéšæœºç”Ÿæˆä¸€ä¸ªå®¹å™¨åï¼ŒæŒ‡å®šå®¹å™¨ååï¼Œå¯ç”¨å®¹å™¨åå¯¹å®¹å™¨è¿›è¡Œæ“ä½œï¼Œå®¹å™¨åä¸èƒ½é‡å¤
> 2. é»˜è®¤ç½‘æ¡¥ç½‘ç»œçš„å®¹å™¨ï¼Œå¿…é¡»æŒ‰ç…§åç§°è¿›è¡Œé€šä¿¡

### è¾“å‡ºå®¹å™¨IDåˆ°æ–‡ä»¶
```shell
docker run --cidfile="<FILE_PATH>" <IMAGE_NAME>
docker run --cidfile <FILE_PATH> <IMAGE_NAME>
```
> 1. è¾“å‡ºçš„æ–‡ä»¶å¿…é¡»æ˜¯ä¸å­˜åœ¨çš„ï¼Œè‹¥å­˜åœ¨ï¼Œä¼šæŠ¥é”™
> 2. è¾“å‡ºçš„IDæ˜¯å®¹å™¨çš„é•¿ID

### ä»æŒ‡å®šçš„é•œåƒç‰ˆæœ¬å¯åŠ¨
```shell
docker run --name <CONTAINER_NAME> <IMAGE_NAME>:<VERSION>
docker run --name test ubuntu:1.0.1
```
### ä»æŒ‡å®šçš„é•œåƒdigestå¯åŠ¨
```shell
docker run <IMAGE_NAME>@<DIGEST>
docker run ubuntu@sha256:f29cc619df1abd6d32c2a5ee274f7068cbc18dd6c45a7908aed0a1fea0e88028
```
> 1. ä½¿ç”¨é•œåƒç‰ˆæœ¬æˆ–æ‘˜è¦æ¥æŒ‡å®šè¿è¡Œå®¹å™¨çš„é•œåƒï¼Œå¯ä»¥é˜²æ­¢é•œåƒæ”¹åŠ¨æˆ–è¢«ç¯¡æ”¹å¸¦æ¥çš„å½±å“
> 2. å¯ä»¥åŒæ—¶æŒ‡å®šé•œåƒç‰ˆæœ¬å’Œé•œåƒæ‘˜è¦
> 3. é•œåƒæ‘˜è¦çš„æ ¼å¼ä¸ºsha256:<UUID>
> 4. åœ¨æ‹‰å–é•œåƒæ—¶åŒæ ·å¯ä»¥ä½¿ç”¨é•œåƒç‰ˆæœ¬å’Œæ‘˜è¦æ¥ç¡®ä¿æ‹‰å–çš„é•œåƒæ˜¯è‡ªå·±æƒ³è¦çš„å¹¶ä¸”æœªè¢«æ›´æ”¹çš„
> 5. å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹é•œåƒçš„æ‘˜è¦
>    1. docker inspect --format="{{.Id}}" <IMAGE_NAME>/<IMAGE_ID>
>    2. docker inspect -f "{{.Id}}" <IMAGE_NAME>/<IMAGE_ID>
>    3. è‹¥é•œåƒåä¸å­˜åœ¨çš„å®¹å™¨åç›¸åŒï¼Œåˆ™ä¼šä¼˜å…ˆè¾“å‡ºå®¹å™¨çš„æ‘˜è¦
>    4. é•œåƒæ‘˜è¦ä¸­çš„UUIDçš„å‰12ä½å°±æ˜¯é•œåƒID

## è®¾ç½®å®¹å™¨çš„å‘½åç©ºé—´
### è®¾ç½®å®¹å™¨çš„PID Namespace

- PID Namespaceï¼šç”¨æ¥éš”ç¦»è¿›ç¨‹ï¼Œä½¿å¾—ä¸åŒçš„PID Namespaceä¸­ï¼Œè¿›ç¨‹å¯ä»¥æ‹¥æœ‰ç›¸åŒçš„è¿›ç¨‹PIDã€‚å› ä¸ºæ¯ä¸ªå®¹å™¨éƒ½é»˜è®¤å®ç°äº†PIDå‘½åç©ºé—´ï¼Œæ‰€ä»¥ä½¿å¾—æ¯ä¸ªå®¹å™¨å†…PIDä¸º1çš„ä¸»è¿›ç¨‹åœ¨ä¸»æœºä¸Šæ‹¥æœ‰ä¸åŒçš„PIDï¼Œä»è€Œå®ç°äº†ä¸åŒå®¹å™¨ä¹‹é—´çš„è¿›ç¨‹éš”ç¦»ã€‚
- ä½œç”¨ï¼šè®¾ç½®å®¹å™¨æ˜¯å¦ä¸ä¸»æœºæˆ–å…¶ä»–å®¹å™¨å…±äº«PIDå‘½åç©ºé—´
```shell
# æ ¼å¼ä¸€ --pid="host" ä¸ä¸»æœºè¿›ç¨‹å…±äº«å‘½åç©ºé—´
docker run --pid="host" --name="test1" ubuntu
# æ ¼å¼äºŒ --pid=container:<CONTAINER_NAME>/<ID> åŠ å…¥å…¶ä»–å®¹å™¨çš„å‘½åç©ºé—´
docker run --pid=container:test1 --name="test2" ubuntu
```
> 1. æ­¤åŠŸèƒ½å¯ç”¨äºè°ƒè¯•å®¹å™¨å†…çš„è¿›ç¨‹

### è®¾ç½®å®¹å™¨çš„UTS Namespace

- UTS Namespaceï¼šç”¨æ¥éš”ç¦»ä¸»æœºåçš„ï¼Œæ¯ä¸€ä¸ªUTS Namespaceå¯ä»¥æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ä¸»æœºå
- ä½œç”¨ï¼šå¯ä»¥ä½¿å®¹å™¨ä¸ä¸»æœºå…±äº«UTS Namespace
```shell
# è®¾ç½®å®¹å™¨ä¸ä¸»æœºå…±äº«UTS Namespace
docker run --uts="host" --name="test" ubuntu
# è®¾ç½®å®¹å™¨çš„UTS Namespcae
docker run --hostname="<NEW_UTS_NAME>" ubuntu
```
> 1. è‹¥å¸Œæœ›å®¹å™¨çš„ä¸»æœºåéšç€ä¸»æœºçš„ä¸»æœºåå˜åŒ–è€Œå˜åŒ–ï¼Œåˆ™å¯ä»¥ä½¿ç”¨--utsæŒ‡ä»¤ã€‚è‹¥æƒ³è®¾ç½®å…¶ä»–çš„ä¸»æœºååˆ™ä½¿ç”¨--hostnameæŒ‡ä»¤
> 2. åœ¨ä½¿ç”¨äº†--utsæŒ‡ä»¤è®¾ç½®äºä¸»æœºå…±äº«UTSåï¼Œ--hostnameå’Œ--domainnameå°†ä¼šå¤±æ•ˆ

### è®¾ç½®å®¹å™¨çš„IPC Namespace

- IPC Namespaceï¼šç”¨æ¥éš”ç¦»è¿›ç¨‹é€šä¿¡çš„ï¼Œå¯ä»¥å®ç°ï¼ŒåŒä¸€IPCçš„è¿›ç¨‹å¯ä»¥é€šä¿¡ï¼Œä¸åŒçš„IPCçš„è¿›ç¨‹ä¸èƒ½é€šä¿¡
- ä½œç”¨ï¼šè®¾ç½®å®¹å™¨çš„IPCæ¨¡å¼
```shell
docker run --ipc="<IPC_MODE>" --name="test" ubuntu
```

| **IPC_MODEå–å€¼** | **æè¿°** |
| --- | --- |
| "" | ä¸æŒ‡å®šï¼Œåˆ™ä½¿ç”¨å®ˆæŠ¤ç¨‹åºçš„é»˜è®¤å€¼ï¼Œå¯é…ç½® |
| "none" | æœ‰ç§æœ‰çš„IPCç©ºé—´ï¼Œä½†æœªè£…å…¥/dev/shm |
| "private" | æœ‰ç§æœ‰çš„IPCç©ºé—´ï¼Œä¸èƒ½ä¸å…¶ä»–å®¹å™¨å…±äº« |
| "shareable" | æœ‰ç§æœ‰çš„IPCç©ºé—´ï¼Œå¯ä»¥ä¸å…¶ä»–å®¹å™¨å…±äº« |
| "container: <_name-or-ID_>" | åŠ å…¥å¦ä¸€ä¸ªå¯å…±äº«çš„å®¹å™¨çš„IPCå‘½åç©ºé—´ |
| "host" | ä½¿ç”¨ä¸»æœºçš„IPCå‘½åç©ºé—´ |

> 1. å½“ä¸€ä¸ªç¨‹åºè¢«åˆ†æˆå¤šä¸ªå®¹å™¨æ—¶ï¼Œå¯ä½¿ç”¨IPCæœºåˆ¶ï¼Œä½¿ä¸»å®¹å™¨è®¾ç½®ä¸ºshareableï¼Œå…¶ä»–å®¹å™¨åˆ™ä½¿ç”¨container: <_name-or-ID_>

## è®¾ç½®å®¹å™¨çš„ç½‘ç»œ
è®¾ç½®å®¹å™¨è¿æ¥åˆ°çš„ç½‘ç»œ
```shell
# docker run --network <NETWORL_NAME> <CONTAINER_NAME>
docker run --network host test
```
> ğŸ’¡ **Noteï¼šå…³äºå®¹å™¨ç½‘ç»œçš„æ›´å¤šè¯¦æƒ…å¯æŸ¥çœ‹æ–‡æ¡£ï¼š**[**å®¹å™¨ç½‘ç»œ**](https://www.yuque.com/kongcheng-l8ycr/ci0y0g/ey1bgb9nygk8a9qw#QbQRy)

## è®¾ç½®å®¹å™¨é‡å¯ç­–ç•¥
åœ¨å®¹å™¨æ„å¤–åœæ­¢æˆ–é€€å‡ºæ—¶ï¼Œå¯ä»¥ç»™å®¹å™¨è®¾ç½®é‡å¯ç­–ç•¥ï¼Œæ˜¯å®¹å™¨é‡æ–°å¯åŠ¨
```shell
# æŒ‡ä»¤æ ¼å¼
docker run --restart=<MODE> redis
# ç¤ºä¾‹
docker run --restart=always redis
docker run --restart=unless-stopped redis
docker run --restart=on-failure:20 redis
```
ä¸»è¦æœ‰å¦‚ä¸‹å‡ ç§ç­–ç•¥ï¼š

| **MODEå–å€¼** | **æè¿°** |
| --- | --- |
| no | ä¸é‡å¯å®¹å™¨ï¼Œé»˜è®¤ç­–ç•¥ |
| on-failure[:max-retries] | å½“å®¹å™¨ä»¥é0é€€å‡ºçŠ¶æ€é€€å‡ºæ—¶ï¼Œé‡å¯å®¹å™¨ï¼Œå¯ä»¥è®¾ç½®é‡å¯çš„æ¬¡æ•° |
| always | å§‹ç»ˆé‡å¯å®¹å™¨ï¼Œæ— è®ºdockerå®ˆæŠ¤ç¨‹åºå¯åŠ¨æ—¶ï¼Œå®¹å™¨çš„çŠ¶æ€æ˜¯ä»€ä¹ˆï¼Œéƒ½ä¼šé‡å¯ |
| unless-stopped | å§‹ç»ˆé‡å¯å®¹å™¨ï¼Œé™¤äº†åœ¨dockerå®ˆæŠ¤ç¨‹åºåœæ­¢ä¹‹å‰å·²ç»åœæ­¢äº†çš„å®¹å™¨ |

> ğŸ’¡ **Note**
> 1. è‹¥é€šè¿‡`docker stop`æˆ–è€…`docker rm` åˆ é™¤å®¹å™¨ï¼Œåˆ™é‡å¯ç­–ç•¥ä¸ä¼šç”Ÿæ•ˆï¼Œæ¢è¨€ä¹‹ï¼Œä¸€æ—¦æ‰‹åŠ¨åœæ­¢æˆ–åˆ é™¤å®¹å™¨é‡å¯ç­–ç•¥å°±ä¼šå¤±æ•ˆ
> 2. æ¯æ¬¡é‡å¯å®¹å™¨æ—¶ä¼šæœ‰ä¸€æ®µé—´éš”æ—¶é—´ï¼Œé»˜è®¤ä¸º100msï¼Œæ¯æ¬¡é‡å¯æ—¶ï¼Œé—´éš”æ—¶é—´éƒ½æ˜¯ä¸Šæ¬¡é‡å¯é—´éš”çš„ä¸¤å€ï¼Œç›´è‡³è¾¾åˆ°æœ€å¤§çš„ä¸€åˆ†é’Ÿé—´éš”ï¼Œæ­¤åä¾¿æ˜¯æ¯éš”ä¸€åˆ†é’Ÿå¯åŠ¨ä¸€æ¬¡
> 3. å½“å®¹å™¨é‡æ–°å¯åŠ¨æˆåŠŸï¼Œå¹¶ä¸”è¿è¡Œè‡³å°‘10ç§’ï¼Œåˆ™é‡å¯é—´éš”æ—¶é—´ä¼šé‡ç½®ä¸º100ms
> 4. å¯ä»¥ç”¨æŒ‡ä»¤`docker inspect -f "{{ .RestartCount }}" <CONTAINER_NAME>/<CONTAINER_ID>`æŸ¥çœ‹å®¹å™¨é‡æ–°å¯åŠ¨çš„æ¬¡æ•°
> 5. å¯ä»¥ç”¨` docker inspect -f "{{ .State.StartedAt }}" <CONTAINER_NAME>/<CONTAINER_ID>`æŸ¥çœ‹ä¸Šæ¬¡å®¹å™¨å¯åŠ¨çš„æ—¶é—´
> 6. `--restart`ä¸èƒ½å’Œ`--rm`ç»„åˆä½¿ç”¨ï¼Œä¼šæŠ¥é”™

## è®¾ç½®é€€å‡ºæ—¶åˆ é™¤å®¹å™¨
```shell
docker run --rm --name="test" ubuntu
```
> 1. åˆ é™¤å®¹å™¨æ—¶ï¼Œè¿˜ä¼šåˆ é™¤ä¸å®¹å™¨å…³è”çš„åŒ¿åå·ï¼Œä»…åˆ é™¤æœªæŒ‡å®šåç§°çš„å·
> 2. ç±»ä¼¼æŒ‡ä»¤`docker run --rm -v /foo -v awesome:/bar ubuntu top`

## å®¹å™¨å®‰å…¨é…ç½®
```shell
docker run --security-opt="<OPTION>" -it ubuntu
```

| **OPTION** | **æè¿°** |
| --- | --- |
| --security-opt="label=user:USER" | è®¾ç½®å®¹å™¨çš„æ ‡ç­¾ç”¨æˆ· |
| --security-opt="label=role:ROLE" | è®¾ç½®å®¹å™¨çš„æ ‡ç­¾è§’è‰² |
| --security-opt="label=type:TYPE" | è®¾ç½®å®¹å™¨çš„æ ‡ç­¾ç±»å‹ |
| --security-opt="label=level:LEVEL" | è®¾ç½®å®¹å™¨çš„æ ‡ç­¾çº§åˆ« |
| --security-opt="label=disable" | å…³é—­å®¹å™¨çš„æ ‡ç­¾é™åˆ¶ |
| --security-opt="apparmor=PROFILE" | è®¾ç½®åº”ç”¨äºå®¹å™¨çš„è®¿é—®æ§åˆ¶æ–‡ä»¶ |
| --security-opt="no-new-privileges:true" | ç¦æ­¢å®¹å™¨è¿›ç¨‹è·å–æ–°æƒé™ |
| --security-opt="seccomp=unconfined" | å…³é—­å®¹å™¨çš„seccompé™åˆ¶ |
| --security-opt="seccomp=profile.json" | ç™½åå•ç³»ç»Ÿè°ƒç”¨seccomp Jsonæ–‡ä»¶ä½œä¸ºseccompç­›é€‰å™¨ |






